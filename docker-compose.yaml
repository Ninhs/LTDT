version: "3.8"

networks:
  nebula-net:
    driver: bridge

services:
  metad:
    image: vesoft/nebula-metad:v3.6.0
    container_name: nebula-metad
    command:
      - --meta_server_addrs=nebula-metad:9559
      - --local_ip=127.0.0.1
    ports:
      - "9559:9559"
    networks:
      - nebula-net
    volumes:
      - Graph:/usr/local/nebula/data/meta
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9559/status"]
      interval: 10s
      timeout: 5s
      retries: 10
    restart: always

  storaged:
    image: vesoft/nebula-storaged:v3.6.0
    container_name: nebula-storaged
    depends_on:
      metad:
        condition: service_healthy
    command:
      - --meta_server_addrs=nebula-metad:9559
      - --local_ip=127.0.0.1
      - --port=9779
    ports:
      - "9779:9779"
    networks:
      - nebula-net
    volumes:
      - Graph:/usr/local/nebula/data/storage
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9779/status"]
      interval: 10s
      timeout: 5s
      retries: 10
    restart: always

  graphd:
    image: vesoft/nebula-graphd:v3.6.0
    container_name: nebula-graphd
    depends_on:
      metad:
        condition: service_healthy
      storaged:
        condition: service_healthy
    command:
      - --meta_server_addrs=nebula-metad:9559
      - --local_ip=127.0.0.1
      - --port=9669
    ports:
      - "9669:9669"
    networks:
      - nebula-net
    restart: always

volumes:
  Graph:
    external: true